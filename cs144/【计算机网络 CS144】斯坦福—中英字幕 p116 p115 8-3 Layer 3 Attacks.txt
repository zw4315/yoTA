# Detected language: en (p=1.00)

[0.00s -> 7.00s]  In this video we'll look at some common attacks that can be performed on layer 3 or IP networks.
[7.00s -> 10.00s]  We will look at three common types of layer 3 attack.
[10.00s -> 17.00s]  It might surprise you to see how simple these attacks are, and you might be left wondering why we don't see even more attacks than we do.
[17.00s -> 22.00s]  The first type of attack uses ICMP, the Internet Control Message Protocol.
[22.00s -> 28.00s]  Recall that ICMP is used to convey information from the network back to the source, telling it how the network is doing.
[28.00s -> 35.00s]  For example, a router can send a TTL expired message back to the source to tell it that a TTL was decremented to zero.
[35.00s -> 44.00s]  Or a router might use ICMP to tell the source host that a destination was unreachable, which means the router has no entry for the destination in its forwarding table.
[44.00s -> 50.00s]  Another type of ICMP message tells the source to send its messages via another router.
[50.00s -> 53.00s]  I'll explain how it works in the next slide.
[53.00s -> 57.00s]  There are lots of types of attack that use BGP, and we'll look at a couple of them here.
[57.00s -> 63.00s]  The first is called BGP hijacking, and sometimes it's just called IP hijacking.
[63.00s -> 74.00s]  BGP attacks take advantage of the fact that neighbouring ISPs trust one another to provide accurate information about the AS path to follow in order to reach a destination prefix.
[74.00s -> 82.00s]  When two BGP peers start up, they create a TCP session over which they pass route advertisements and withdrawals.
[82.00s -> 88.00s]  Once the session is initiated, they trust each other to provide the true information about paths.
[88.00s -> 99.00s]  If an ISP is badly behaved, or if someone manages to break into the TCP session and masquerade as a legitimate ISP, then it is quite easy to redirect traffic.
[99.00s -> 106.00s]  For example, an ISP can advertise a prefix belonging to someone else, capturing their traffic.
[106.00s -> 118.00s]  Or an ISP can advertise an invalid AS path, sending the IP traffic to a non-existent destination where it is dropped, creating what is called a black hole for the traffic.
[118.00s -> 129.00s]  And because BGP routers only peer with neighbouring BGP routers, the most likely way for a BGP attack to happen is when an ISP is badly behaved.
[129.00s -> 138.00s]  It's quite hard for an attacker to persuade a BGP router to start a session with it. The routers are hard-coded to only talk to particular peers.
[138.00s -> 145.00s]  However, on occasion, an attacker will manage to take over an ongoing TCP session without either party knowing.
[145.00s -> 149.00s]  We'll explore how that might work in a later video.
[150.00s -> 160.00s]  Another closely related BGP attack is when an ISP inserts a more specific prefix to divert just a portion of an address space.
[160.00s -> 168.00s]  Again, this requires the attacker to masquerade as an ISP, or to take over a BGP TCP session.
[168.00s -> 175.00s]  Let's first see how a legitimate ICMP redirect works, then we'll look at how an attacker can exploit it.
[175.00s -> 180.00s]  Alice is connected to her company's network, which is connected to the public Internet via a router.
[180.00s -> 184.00s]  Alice wants to send a packet to her colleague Bob, who works at the same company.
[184.00s -> 187.00s]  They are connected via the company's private network.
[187.00s -> 191.00s]  Alice's computer is configured with Router 1 as the default router.
[191.00s -> 196.00s]  In other words, packets destined for a different subnet will be sent via Router 1.
[196.00s -> 200.00s]  But actually, her packets to Bob should really go via Router 2 instead.
[201.00s -> 208.00s]  When the packet arrives to Router 1, it notices that the packet is routed back to the interface it arrived on.
[208.00s -> 212.00s]  This tells Router 1 that Alice sent the packet to the wrong router.
[212.00s -> 219.00s]  Router 1 forwards the packet to Router 2, and then sends an ICMP redirect message to Alice,
[219.00s -> 224.00s]  to tell her to send packets to Bob via Router 2 in future.
[224.00s -> 228.00s]  Alice's computer adds a new routing entry in its local routing table.
[228.00s -> 233.00s]  Next time Alice has a packet for Bob, her computer sends it to Router 2 instead.
[233.00s -> 238.00s]  This is how ICMP redirects are supposed to work.
[238.00s -> 241.00s]  And all is good in this particular example.
[243.00s -> 245.00s]  Until an attacker comes along.
[245.00s -> 250.00s]  The attacker can send an ICMP redirect message to Alice,
[250.00s -> 255.00s]  to tell her to route packets to prefix A via the attacker's computer instead.
[255.00s -> 260.00s]  And so when Alice sends a packet to Bob, her computer sends it to the attacker instead.
[262.00s -> 268.00s]  The attacker might choose to drop the packet, denying Alice from being able to communicate with Bob,
[268.00s -> 274.00s]  or the attacker might look at the packet before forwarding it to Bob, creating a man-in-the-middle attack.
[277.00s -> 282.00s]  BGP attacks exploit one or more security vulnerabilities in BGP.
[283.00s -> 289.00s]  The first vulnerability is that an AS can advertise IP addresses that it doesn't own.
[289.00s -> 295.00s]  This means it can advertise IP addresses that belong to another AS, and therefore create spurious problems.
[295.00s -> 299.00s]  As you can imagine, this is a major vulnerability in BGP.
[299.00s -> 303.00s]  An AS cannot tell if an advertisement is legitimate or not.
[304.00s -> 308.00s]  Furthermore, an AS cannot verify that an AS path is correct.
[308.00s -> 314.00s]  There is no way for a BGP router to know if the sequence of ASs leading to an advertised prefix
[314.00s -> 317.00s]  actually leads to the correct destination or not.
[318.00s -> 323.00s]  ISPs exchange BGP messages over a regular TCP session.
[323.00s -> 329.00s]  If an attacker is able to take over the TCP session, or inject packets into the session undetected,
[329.00s -> 335.00s]  then it can cause incorrect AS paths to be advertised, and can hijack portions of the address space.
[336.00s -> 341.00s]  One thing that is very surprising to many people, that is, even today,
[341.00s -> 349.00s]  almost any ISP can bring down the Internet by advertising bad routes, either accidentally or maliciously.
[349.00s -> 355.00s]  Let's look at some famous cases of when BGP problems caused huge problems in the Internet.
[355.00s -> 359.00s]  Perhaps the most celebrated case happened in 2008,
[359.00s -> 364.00s]  when Pakistan Telecom tried to block access to YouTube inside Pakistan.
[365.00s -> 372.00s]  Instead of making local changes, the ISP inadvertently propagated false BGP advertisements throughout the Internet.
[372.00s -> 378.00s]  In fact, many thousands of routing entries were injected into the Internet routing system in just a few minutes.
[378.00s -> 385.00s]  Almost the entire Internet melted down, with YouTube being effectively incapacitated for several hours.
[386.00s -> 394.00s]  In 2004, an ISP in Malaysia called DataOne is believed to have mounted a malicious attack on Yahoo to try and block it.
[394.00s -> 400.00s]  All the way from Malaysia, they were able to easily hijack two of Yahoo's Santa Clara prefixes,
[400.00s -> 403.00s]  making Yahoo's data centers inoperable.
[404.00s -> 410.00s]  In 2003, spammers deliberately hijacked a block of IP addresses allocated Northrop Grunham,
[410.00s -> 414.00s]  a large US-based security contractor for the government.
[414.00s -> 421.00s]  Once they had hijacked a portion of the IP address space, they used the addresses to launch huge amounts of spam.
[422.00s -> 430.00s]  In 2004, TTnet, a Turkish ISP, sent full BGP routing tables announcing to everyone in the world
[430.00s -> 434.00s]  that Turkey is the best path to everywhere in the Internet.
[434.00s -> 438.00s]  All of a sudden, almost the entire Internet tried to route via Turkey.
[438.00s -> 443.00s]  You can imagine what chaos it created. Most of the Internet didn't work for hours.
[444.00s -> 451.00s]  A similar problem almost happened in 2008, when CTBC in Brazil sent full BGP routing tables
[451.00s -> 455.00s]  that would have hijacked almost every carrier's IP address block.
[455.00s -> 459.00s]  Luckily, a BGP monitoring system noticed just in time.
[459.00s -> 463.00s]  Many people believed it was a malicious attack aimed at blocking Yahoo.
[464.00s -> 471.00s]  There are many, many more that happen every day, mostly too small to make the headlines, but some are very large.
[472.00s -> 479.00s]  The network is almost as vulnerable today as it was in 2004, with very few new security improvements.
[481.00s -> 485.00s]  One ISP can hijack the address block of another very easily.
[485.00s -> 491.00s]  Consider Alice in AS1, sending her packets to Bob, who is attached to prefix A
[491.00s -> 496.00s]  somewhere across the Internet on the right-hand side in AS3, many ASs away.
[497.00s -> 506.00s]  Alice's neighbouring AS, AS2, advertises correctly that the best path to Bob in AS3 is via AS2.
[511.00s -> 514.00s]  The attacker has a different idea.
[514.00s -> 519.00s]  The attacker is able to take over and control the BGP router in ASEvil.
[520.00s -> 529.00s]  Once the attacker has control of the BGP sessions between ASEvil and AS2, it can advertise new false AS paths.
[529.00s -> 539.00s]  For example, it can advertise a path saying that the 16-bit prefix 171.64 can be reached via ASEvil instead.
[539.00s -> 547.00s]  AS1 has no way of knowing that this is a lie, and so might start routing traffic to ASEvil instead.
[548.00s -> 553.00s]  The attacker might choose to drop all the packets, making it impossible for Alice to talk to Bob.
[553.00s -> 559.00s]  Or the attacker might establish a man-in-the-middle attack without Alice or Bob knowing.
[560.00s -> 567.00s]  If the attacker doesn't want to arouse too much suspicion, it doesn't have to take over the whole of that 16-bit prefix.
[568.00s -> 579.00s]  For example, if instead the attacker injects a 24-bit prefix, 171.64.74, then only a portion of the traffic will be diverted via the attacker's AS.
[580.00s -> 591.00s]  All of the attacks on BGP that I showed you require the attacker to first compromise one AS, then use the trust between ASs to inject false advertisements into the other ASs.
[592.00s -> 597.00s]  But what if the attacker can insert itself in between the two BGP peers without them knowing?
[597.00s -> 601.00s]  This would allow it to inject false routes without anyone knowing.
[601.00s -> 603.00s]  That's doubly scary.
